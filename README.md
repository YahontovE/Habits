# __трекер полезных привычек__
___
___
# О проекте 
> Удобное приложение для   приобретения новых полезных привычек и искоренению старых плохих привычек.
## ___Функции___
- _Пользователь создает свои полезные пирвычки_
- _Делится своими полезными привычками с пользователями приложения_
- _Отмечать, когда было бы удобно выполнять полызные привычки "время"_
- _Отмечать, сколько раз в неделю нужно выполянть привычку_
- _Отрпавлять сообщения в через телеграм бот в указанное время с указанной периодичностью_
___

## Сущности системы
  ### Привычка
  * пользователь
  * место выполнения
  * время выполнения
  * действие
  * связанная привычка (__опционально__)
  * признак приятной привычки
  * периодичность
  * вознаграждение
  * время на выполнение
  * признак публичности
  * время поледней отправки сообщения(__автоматически__)

### Пользователь
* имя пользователя
* пароль
* почта (__опционально__)
* telgram id (__опционально__)

## Документация API
Документация для API реализована с помощью drf-yasg и находится на следующих эндпоинтах:
* http://127.0.0.1:8000/docs/
* http://127.0.0.1:8000/redoc/

## CORS
Для безопасности API реализован CORS с помощью django-cors-headers. 

В модуле ``settings.py`` необходимо внести изменения в следующие настройки, если у вас есть сторонние домены, обращающиеся к вашему API:

```
CORS_ALLOWED_ORIGINS = [
    "https://read-only.example.com",
    "https://read-and-write.example.com",
]

CSRF_TRUSTED_ORIGINS = [
    "https://read-and-write.example.com",
]
```

## Перед первым запуском программы:

* Склонировать репозиторий в IDE
  
  В терминале ввести команду:
  ```
  git clone https://github.com/toir02/TaskTracker
* Установить вирутальное окружение

  В терминале ввести команду:
  ```
  python3 -m venv venv
  ```
* Активировать виртуальное окружение

  В терминале ввести команду:
  ```
  source venv/bin/activate
  ```
* Установить зависимости

  В терминале ввести команду:
  ```
  pip install -r requirements.txt
  ```
* Создать файл ``.env``. Его необходимо заполнить данными из файла ``.env.sample``
* Создайте Базу данных (в данной работе используется PostgreSQL)
* Создать и применить миграции

  В терминале ввести следующие команды:
  ```
  python3 manage.py makemigrations
  ```
  ```
  python3 manage.py migrate
  ```
* Запустить сервер

  В терминале ввести команду:
  ```
  python3 manage.py runserver
  ```
* Для работы с периодической задачей необходимо включить брокер redis, celery worker и celery beat
  **Для запуска отложенный задач(*отправка сообщения с привычкой*), нужно:

  В терминале ввести следующие команды:
  ```
  sudo systemctl start redis
  ```
  ```
  celery -A config worker -l INFO (для пользователей Windows OS нужно дописать `-P eventlet`)
  ```
  ```
  celery -A config beat -l INFO

***
## Работа кода

**Создание пользователя**
- Перед тем, как создать пользователя, создайте/войдите в аккаунт Telegram и перейдите по ссылке 
[Tg-бота](https://t.me/getmyid_bot). При выполнении команды `/start` вы получите User ID и Chat ID.
- Создание пользователя проходит через `post`-запрос в сервисе для обслуживания API(Например, [Postman](https://www.postman.com/)).
При создании пользователя в поле `chat_id` прописывается ID, полученный от [Tg-бота](https://t.me/getmyid_bot).
- После регистрации идет получение токена: через указания данных(Поля `username` и `password`) производится `post`-запрос.
При получении ответа, нужно скопировать значение ключа `access` и при дальнейшем пользовании в поле авторизации прописывать
`Bearer {token}` 


**Создание Tg-бота**
* Создайте бота и получите токен
(`https://sendpulse.com/ru/knowledge-base/chatbot/telegram/create-telegram-chatbot`)
- Токен будет использован ботом для обращения к API Telegram-сервисов, поэтому его необходимо сразу сохранить в переменные окружения(.env) и не распространять.
## Для завершения работы

В терминале, где запущен сервер, worker и beat, прожать **Ctrl + C**
